# DRM Suite 機能一覧（建設業向けCRM）

## 📋 実装状況凡例

- ✅ 実装済み
- 🚧 部分実装
- ❌ 未実装

---

## 🎉 最新の実装（2025/10/12）

### 🚀 Phase 10完了: 顧客管理機能の完全実装（NEW!）

**コミット**: `6c312e6`, `8466b32`, `84254b7`, `802e690`, `dfcb5e8` - 2025/10/12

#### Phase 10 実装内容（4機能全て完了）

**1. 顧客セグメンテーション分析** (`/customers/segmentation`)

- ✅ A/B/C/Dランクの自動判定（5要素スコアリング）
- ✅ 売上貢献度30%・頻度25%・粗利率20%・鮮度15%・成長率10%
- ✅ リスク評価（高・中・低）
- ✅ 営業戦略の自動推奨
- ✅ レーダーチャート可視化
- ✅ セグメント別売上貢献度分析

**2. 案件パイプライン管理** (`/customers/pipeline`)

- ✅ 7ステージ管理（リード→初回接触→商談→提案→見積→受注/失注）
- ✅ カンバンボード形式
- ✅ 案件詳細モーダル
- ✅ 受注率・予想売上の自動計算
- ✅ 確度加味の予想売上計算
- ✅ 担当者フィルタリング

**3. 顧客コミュニケーション履歴** (`/customers/communications`)

- ✅ 8タイプ記録（電話・メール・ミーティング・訪問・LINE・チャット・SMS・メモ）
- ✅ タイムライン表示
- ✅ 方向別管理（着信/発信）
- ✅ 感情分析（ポジティブ・ニュートラル・ネガティブ）
- ✅ 次のアクション記録
- ✅ タイプ別統計グラフ

**4. 顧客タグ・カテゴリ管理** (`/customers/tags`)

- ✅ タグマスタ管理（CRUD完備）
- ✅ 6カテゴリ分類（工事種別・顧客属性・優先度・ステータス・獲得経路・カスタム）
- ✅ 色・アイコンカスタマイズ（9色パレット）
- ✅ 使用統計の可視化
- ✅ TOP使用タグランキング

**UI統一**: 全画面で青グラデーションテーマ採用（`bg-gradient-dandori`）

**統計**: 11ファイル追加、4,209行追加、API 4個、画面 4個

---

### 💰 Phase 9完了: 請求・入金・キャッシュフロー管理

**コミット**: `e9d9ca4`, `fec9f78`, `d02ee33`, `658aecb`, `689afea`, `34d6fed` - 2025/10/12

#### Phase 9 実装内容（4ステップ完了）

**Step 1: 請求管理の強化**

- ✅ 請求一覧画面のAPI連携（`/invoices`）
- ✅ 請求詳細画面の4タブUI（概要・明細・入金管理・関連情報）
- ✅ 入金記録の追加・編集機能
- ✅ 請求書一覧からの直接遷移

**Step 2: 入金管理システム**

- ✅ 入金記録API（`/api/payments`）- CRUD操作、自動請求書更新
- ✅ 入金予定管理API（`/api/payment-schedules`）- 期日管理、アラート計算
- ✅ 入金遅延アラートAPI（`/api/payment-alerts`）- 4段階の重要度判定

**Step 3: 支払管理システム**

- ✅ 支払予定管理API（`/api/disbursement-schedules`）- 承認フロー付き
- ✅ 支払実績記録API（`/api/disbursements`）- 発注との紐付け
- ✅ 支払管理画面（`/disbursements`）- 2タブUI
- ✅ 500万円以上の支払は自動承認要求

**Step 4: キャッシュフロー管理**

- ✅ キャッシュフロー予定表API（`/api/cashflow/schedule`）- 日次・週次・月次集計
- ✅ キャッシュフロー予測API（`/api/cashflow/forecast`）- 3シナリオ分析
- ✅ 資金繰り表画面（`/cashflow`）- リスク評価と推奨アクション
- ✅ シナリオ別予測（楽観的・現実的・悲観的）
- ✅ 資金ショート早期検知システム

**経理ダッシュボード統合**: Phase 9機能を経理ダッシュボードに完全統合

**統計**: 15ファイル変更、5,872行追加

---

### Phase 8完了: 工事台帳・原価管理システム（完全版）

#### 🆕 新機能（2025/10/12追加）

**Step 1-3: 自動原価集計とアラート機能**

1. **発注からの自動原価集計** (`/api/construction-ledgers/update-budget`)
   - 発注時に工事分類から原価科目を自動判定
   - 材料費・労務費・外注費・経費への自動振り分け
   - 実行予算の自動更新
   - 発注キャンセル時の予算減算処理

2. **DW実績原価の工事台帳反映** (`/api/construction-ledgers/update-actual-cost`)
   - DWシステムから受信した実績原価を自動反映
   - 予算との差異分析（科目別・総額）
   - 実績粗利の自動計算
   - 工事進捗情報の連動更新

3. **リアルタイムアラート生成**
   - 原価超過アラート（予算95%超過で重大、超過で警告）
   - 粗利低下アラート（予定粗利の80%未満で警告）
   - 赤字案件アラート（実績粗利マイナスで重大）

**Step 4: 工事台帳詳細画面の強化** (`/construction-ledgers/[id]`)

1. **クイックアクション**
   - DW同期ボタン（最新原価を即時取得）
   - CSV出力ボタン（工事台帳データのエクスポート）

2. **視覚化チャート**
   - 予算vs実績 比較チャート（科目別棒グラフ）
   - 原価差異チャート（中央軸から左右に伸びるバー）
   - 工事タイムライン（4つのマイルストーン表示）

3. **発注・請求サマリー**
   - 発注一覧（カード形式、最大6件表示）
   - 請求一覧（カード形式、最大6件表示）
   - ステータスバッジ付き表示

**Step 5: 発注管理強化** (`/orders`)

1. **工事台帳連携**
   - 工事台帳フィルター機能
   - 工事台帳カラム表示（クリックで詳細画面へ遷移）
   - 未割り当て発注の可視化

#### 📈 実装進捗

- 実装済み機能: **約55%** (Phase 1-10完了！)
- 完了フェーズ: Phase 1-10
- Phase 9追加: 15ファイル、5,872行
- Phase 10追加: 11ファイル、4,209行
- 次のフェーズ: Phase 11（アナリティクス・AI機能拡張）

#### 📊 過去実装（2025/10/08）

- 勘定科目マスタ（3階層、60+項目）
- 工事項目マスタ（15+サンプルデータ）
- 原価明細入力機能

---

## 1️⃣ 営業・顧客管理 🆕

### 1.1 顧客管理

- 🚧 顧客マスタ（個人・法人）- サンプルデータあり
- 🚧 顧客情報（連絡先・住所・担当者）- サンプルデータあり
- ✅ 商談履歴 - コミュニケーション履歴として実装 (`/customers/communications`)
- ✅ 顧客ランク・評価 - A/B/C/Dセグメンテーション実装 (`/customers/segmentation`)
- ✅ 顧客タグ管理 - 6カテゴリのタグシステム実装 (`/customers/tags`)

### 1.2 案件管理 ✅

- ✅ 案件パイプライン（リード→初回接触→商談→提案→見積→受注/失注）(`/customers/pipeline`)
- ✅ 案件進捗管理 - 7ステージ管理
- ✅ 案件詳細モーダル - 案件情報・顧客情報・次のアクション
- ✅ 確度管理 - ステージ別自動確度設定
- ✅ 予想売上計算 - 確度加味の予想売上
- ✅ 受注率分析 - パイプライン統計

### 1.3 顧客セグメンテーション ✅

- ✅ A/B/C/Dランク自動判定 (`/customers/segmentation`)
- ✅ 5要素スコアリング（売上・頻度・粗利率・鮮度・成長率）
- ✅ リスク評価（高・中・低）
- ✅ 営業戦略自動推奨
- ✅ セグメント別売上分析
- ✅ レーダーチャート可視化

### 1.4 コミュニケーション管理 ✅

- ✅ 8タイプのコミュニケーション記録 (`/customers/communications`)
- ✅ タイムライン表示
- ✅ 方向別管理（着信/発信）
- ✅ 感情分析（ポジティブ・ニュートラル・ネガティブ）
- ✅ 次のアクション記録
- ✅ タイプ別統計

---

## 2️⃣ 見積管理 ✅

### 2.1 見積作成

- ✅ 見積作成フロー (`/estimates/create-v2`)
- ✅ 見積エディタ (`/estimates/editor-v3`)
  - マスター原価参照（75種類以上）
  - ドラッグ&ドロップ
  - 階層型マスタ検索
  - 原価管理・粗利計算
- ✅ 資金計画書 (`/estimates/financial`)
- ✅ テンプレート管理

### 2.2 見積管理

- ✅ 見積一覧・検索
- ✅ ステータス管理（下書き→提出→交渉→受注/失注）
- ✅ 失注理由記録
- ✅ 複数見積管理（A案/B案/C案）
- ❌ 見積比較機能
- ❌ 見積履歴管理

### 2.3 見積分析

- 🚧 受注率可視化（基本統計のみ）
- ❌ 見積精度分析（見積vs実績）
- ❌ 競合分析

---

## 3️⃣ 契約管理 ✅

### 3.1 契約作成

- ✅ 見積→契約自動変換 (`/api/contracts/from-estimate`)
- ✅ 契約書作成
- ✅ 項目マッピング設定

### 3.2 契約管理

- ✅ 契約一覧・検索
- ✅ 契約詳細画面
- ✅ ステータス管理（下書き→承認待ち→締結→進行中→完了）
- ❌ 契約書PDF生成
- ❌ 契約書電子署名

### 3.3 契約変更

- ❌ 変更契約管理
- ❌ 増減額管理
- ❌ 工期変更管理

---

## 4️⃣ 工事台帳（建設業の核心） 🚧

### 4.1 工事基本台帳

- ✅ 工事台帳一覧 (`/construction-ledgers`)
- ✅ 工事台帳詳細 (`/construction-ledgers/[id]`)
- ✅ 契約→工事台帳変換
- ✅ 工事基本情報
  - 工事名称
  - 発注者情報
  - 工事場所
  - 工事種別
  - 工期（開始・完了予定・実完了）
  - 契約金額・受注金額

### 4.2 工事原価台帳

- ✅ 原価明細入力機能 (`/construction-ledgers/[id]` - 原価明細タブ)
  - 日付・勘定科目選択
  - 金額入力（税抜・税率・税込）
  - 仕入先・請求書番号
  - 支払状況管理（未払い・一部支払・支払済）
- ✅ 原価科目別管理
  - ✅ 材料費
  - ✅ 労務費
  - ✅ 外注費
  - ✅ 経費
- ✅ カテゴリ別集計サマリー
- ✅ 原価明細CRUD操作
- ✅ 実行予算作成（発注からの自動集計）
- ✅ 予算vs実績管理（視覚化チャート付き）
- ✅ 原価差異分析（科目別・総額、視覚化チャート付き）
- ✅ 粗利管理（予定粗利vs実績粗利、リアルタイム計算）
- ✅ アラート機能（原価超過・粗利低下・赤字案件）

### 4.3 工事進捗管理

- ❌ 工事進捗率管理
- ❌ 出来高管理
- ❌ 工程表管理
- ❌ 予定vs実績管理

### 4.4 統合ビュー

- ❌ 案件統合ダッシュボード
  - 見積情報
  - 契約情報
  - 発注情報
  - 原価情報
  - 請求情報
  - 入金情報

---

## 5️⃣ 発注管理 ✅

### 5.1 協力会社管理

- ✅ 協力会社マスタ (`/admin/partners`)
- ✅ 評価・実績管理
- ✅ 専門分野・対応エリア

### 5.2 発注作成

- ✅ 契約→発注変換
- ✅ 分離発注（35業種対応）
- ✅ 工事分類別一括発注
- ✅ 協力会社自動提案
- ✅ 7日期限管理

### 5.3 発注管理

- ✅ 発注一覧・検索
- ✅ 発注詳細
- ✅ 期限アラート（7日ルール）
- ✅ 工事台帳連携（フィルター・カラム表示）
- ✅ 工事台帳への自動反映
- ❌ 発注書PDF生成
- ❌ 協力会社ポータル（発注確認・進捗報告）

---

## 6️⃣ 原価管理 ✅

### 6.1 原価マスタ

- ✅ 勘定科目マスタ (`/admin/account-subjects`)
  - 3階層構造（大分類/中分類/小分類）
  - 60+項目（材料費・労務費・外注費・経費）
  - 会計ソフト連携コード設定
  - 階層型管理画面
- ✅ 工事項目マスタ (`/admin/construction-items`)
  - 工事項目管理（基礎工事、大工工事、設備工事等）
  - 5種類の単位対応（坪/平米/メーター/箇所/定額）
  - 単価設定
  - デフォルト勘定科目紐付け
  - カテゴリ分類（躯体工事・設備工事・仕上工事・外構工事・その他）
  - 15+サンプルデータ付き
- 🚧 原価マスタ参照（見積エディタ内）
- ❌ 原価更新履歴

### 6.2 DW連携

- ✅ DWへの発注送信API (`/api/orders/sync-to-dw`)
- ✅ DWからの原価受信API (`/api/orders/sync-from-dw`)
- ✅ ハイブリッドID管理

### 6.3 原価管理ダッシュボード

- ✅ 予算vs実績比較 (`/cost-management`)
- ✅ 予算超過アラート
- ✅ CSV出力
- ❌ 案件別原価推移グラフ
- ❌ 原価科目別分析
- ❌ 粗利推移分析

### 6.4 原価分析

- ❌ 見積原価 vs 実行予算 vs 実績原価（3段階比較）
- ❌ 工種別原価分析
- ❌ 協力会社別原価分析
- ❌ 原価低減分析

---

## 7️⃣ 請求・入金管理 ✅

### 7.1 請求管理 ✅

- ✅ 契約→請求自動変換 (`/api/invoices/from-contract`)
- ✅ 請求書作成 (`/invoices/create`)
- ✅ 請求一覧 (`/invoices`) - API連携完了
- ✅ 請求詳細画面 (`/invoices/[id]`) - 4タブUI
  - 概要タブ
  - 明細タブ
  - 入金管理タブ
  - 関連情報タブ
- ❌ 請求書PDF生成
- ❌ 電子送付（メール）

### 7.2 入金管理 ✅

- ✅ 入金予定管理 (`/api/payment-schedules`)
- ✅ 入金実績登録 (`/api/payments`) - CRUD操作完備
- ✅ 入金遅延アラート (`/api/payment-alerts`) - 4段階の重要度判定
- ✅ 入金消込機能 - 請求書との自動紐付け
- ✅ 入金記録追加・編集モーダル
- ✅ 期日管理・アラート計算

### 7.3 支払管理 ✅

- ✅ 協力会社への支払予定 (`/api/disbursement-schedules`)
- ✅ 支払実績登録 (`/api/disbursements`)
- ✅ 支払スケジュール管理 (`/disbursements`) - 2タブUI
  - 支払予定タブ
  - 支払実績タブ
- ✅ 発注との紐付け
- ✅ 承認フロー（500万円以上は自動承認要求）
- ✅ ステータス管理（予定→承認待ち→承認済→支払済）

### 7.4 キャッシュフロー ✅

- ✅ 入金・支払予定表 (`/api/cashflow/schedule`) - 日次・週次・月次集計
- ✅ キャッシュフロー予測 (`/api/cashflow/forecast`) - 3シナリオ分析
- ✅ 資金繰り表 (`/cashflow`)
  - シナリオ別予測（楽観的・現実的・悲観的）
  - リスク評価
  - 推奨アクション表示
  - 資金ショート早期検知
- ✅ 経理ダッシュボード統合
  - 入金予定アラート
  - 支払予定アラート
  - キャッシュフロー予測サマリー

---

## 8️⃣ 承認ワークフロー ✅

### 8.1 承認フロー設定

- ✅ 承認フロー管理（管理画面）
- ✅ 役職別承認ルート

### 8.2 承認管理

- ✅ 承認一覧 (`/approvals`)
- ✅ 承認・却下機能
- ✅ ステータス管理
- ✅ 優先度管理

### 8.3 承認プロセス

- 🚧 見積承認（フローは設定済み、実際の承認連携は未実装）
- 🚧 契約承認（フローは設定済み、実際の承認連携は未実装）
- 🚧 発注承認（フローは設定済み、実際の承認連携は未実装）
- 🚧 請求承認（フローは設定済み、実際の承認連携は未実装）

---

## 9️⃣ 通知システム ✅

### 9.1 管理者設定

- ✅ メール通知設定 (`/admin/notification-settings`)
- ✅ Slack通知設定
- ✅ Chatwork通知設定
- ✅ 通知トリガー設定（19種類）
- ✅ 通知タイミング設定

### 9.2 個人設定

- ✅ 個人通知設定 (`/settings/notifications`)
- ✅ 通知方法選択（メール・Slack・Chatwork）
- ✅ 通知頻度設定（リアルタイム・1時間・1日・週1）
- ✅ 勤務時間外制御
- ✅ 優先度フィルター

### 9.3 通知送信

- ❌ 実際のメール送信機能
- ❌ 実際のSlack送信機能
- ❌ 実際のChatwork送信機能

---

## 🔟 管理機能

### 10.1 ユーザー・組織管理 ✅

- ✅ ユーザー管理（42名体制）
- ✅ 権限管理（9段階の役職レベル、24種類の権限）
- ✅ 組織構造管理（ドラッグ&ドロップ）
- ✅ 部署管理

### 10.2 マスタ管理

- ✅ 協力会社マスタ (`/admin/partners`)
- ✅ 勘定科目マスタ (`/admin/account-subjects`)
  - 3階層構造（大分類/中分類/小分類）
  - 60+項目（材料費・労務費・外注費・経費）
  - 会計ソフト連携用コード設定
- ✅ 工事項目マスタ (`/admin/construction-items`)
  - 工事項目・単価管理
  - 5種類の単位対応
  - 勘定科目紐付け
- 🚧 原価マスタ（見積エディタ内のみ）
- ❌ 工事種別マスタ
- ❌ 材料マスタ
- ❌ 見積項目マスタ

### 10.3 システム設定

- ✅ ワークフロー設定 (`/admin/workflow-settings`)
- ✅ 発注設定 (`/admin/order-settings`)
- ✅ 請求設定 (`/admin/billing-settings`)
- ✅ 原価設定 (`/admin/cost-settings`)
- ✅ 通知設定 (`/admin/notification-settings`)
- ❌ セキュリティ設定
- ❌ バックアップ設定

---

## 1️⃣1️⃣ レポート・分析

### 11.1 営業分析

- ❌ 受注率分析
- ❌ 営業担当別実績
- ❌ 失注理由分析
- ❌ 売上予測

### 11.2 工事分析

- ❌ 工事別収益分析
- ❌ 工種別分析
- ❌ 地域別分析
- ❌ 顧客別分析

### 11.3 原価分析

- ❌ 原価率推移
- ❌ 粗利率推移
- ❌ 協力会社別原価分析
- ❌ 見積精度分析（見積vs実績）

### 11.4 経営ダッシュボード

- 🚧 経営ダッシュボード（基本統計のみ）
- ❌ KPI管理
- ❌ 予実管理（全社）
- ❌ 部門別実績

---

## 1️⃣2️⃣ ドキュメント管理

### 12.1 PDF管理

- ❌ 見積書PDF生成
- ❌ 契約書PDF生成
- ❌ 発注書PDF生成
- ❌ 請求書PDF生成
- ❌ PDFテンプレート管理

### 12.2 書類管理

- ❌ 案件別書類管理
- ❌ 書類アップロード
- ❌ 書類バージョン管理
- ❌ 電子署名

### 12.3 図面管理

- ❌ 図面アップロード
- ❌ 図面バージョン管理
- ❌ 図面閲覧・コメント

---

## 1️⃣3️⃣ モバイル・外部連携

### 13.1 モバイル対応

- 🚧 レスポンシブデザイン（一部画面のみ）
- ❌ モバイル専用アプリ
- ❌ 現場報告アプリ

### 13.2 外部連携

- 🚧 DW連携（API実装済み、実際の連携は未）
- ❌ 会計ソフト連携
- ❌ 銀行API連携
- ❌ メール連携

---

## 📊 実装優先度の推奨

### 🔴 最優先（建設業の核心機能） - Phase 1-10 完了！

1. ~~**工事台帳**~~ ✅ Phase 8完了
2. ~~**工事原価台帳**~~ ✅ Phase 8完了
3. ~~**原価マスタ管理**~~ ✅ Phase 8完了
4. ~~**入金・支払管理**~~ ✅ Phase 9完了
5. ~~**キャッシュフロー管理**~~ ✅ Phase 9完了
6. ~~**顧客管理・パイプライン**~~ ✅ Phase 10完了

### 🟡 高優先（業務効率化）

7. **PDF生成機能** - 見積書・契約書・発注書・請求書
8. **原価自動計算機能** - 工事項目マスタ活用
9. **協力会社選択機能** - 工事項目ごとの協力会社紐付け
10. **承認ワークフロー実装** - 見積・契約・発注・請求との実際の連携
11. **実際の通知送信** - メール・Slack・Chatwork

### 🟢 中優先（分析・改善）

12. **営業分析機能** - 受注率・失注理由・売上予測
13. **工事分析機能** - 工事別収益・地域別分析
14. **原価分析機能** - 見積vs実行予算vs実績原価の3段階比較
15. **経営ダッシュボード拡張** - KPI管理・部門別実績

### 🔵 低優先（拡張機能）

16. **図面管理**
17. **モバイルアプリ**
18. **外部連携**（会計ソフト・銀行API等）
19. **AI機能**（受注予測・原価予測）

---

## 💡 次のステップ提案

### ✅ Phase 1-10: 完了済み（コアシステム構築完了！）

1. ✅ **Phase 1-7**: 見積・契約・発注・原価・承認管理
2. ✅ **Phase 8**: 工事台帳・原価管理システム完全版
3. ✅ **Phase 9**: 請求・入金・キャッシュフロー管理
4. ✅ **Phase 10**: 顧客管理（セグメンテーション・パイプライン・履歴・タグ）

### 📄 Phase 11: PDF生成機能（次の優先候補）

1. 見積書PDF生成
2. 契約書PDF生成
3. 発注書PDF生成
4. 請求書PDF生成
5. PDFテンプレート管理
6. 電子送付機能（メール添付）

### 📊 Phase 12: 分析・レポート機能

1. **営業分析ダッシュボード**
   - 受注率分析
   - 失注理由分析
   - 営業担当別実績
   - 売上予測
2. **工事分析ダッシュボード**
   - 工事別収益分析
   - 工種別分析
   - 地域別分析
   - 粗利率推移
3. **原価分析ダッシュボード**
   - 見積vs実行予算vs実績原価（3段階比較）
   - 協力会社別原価分析
   - 見積精度分析

### 🔗 Phase 13: 外部連携・自動化

1. **会計ソフト連携**
   - 仕訳データ自動送信
   - 勘定科目マッピング
2. **銀行API連携**
   - 入金自動照合
   - 振込依頼
3. **メール連携**
   - 見積書・請求書の自動送信
   - 入金期限リマインダー

### 🤖 Phase 14: AI機能・高度な予測

1. **受注予測AI**
   - 過去データから受注確率予測
   - 最適価格提案
2. **原価予測AI**
   - 類似案件からの原価予測
   - 異常値検知
3. **工期予測AI**
   - 適切な工期自動算出
   - 遅延リスク検知

---

**最終更新**: 2025/10/12 02:50
**実装済み機能**: 約55%（Phase 1-10完了！）
**現在のフェーズ**: Phase 11 - PDF生成・分析機能拡張
**次のマイルストーン**: PDF生成機能（見積書・契約書・発注書・請求書）
**総実装規模**:

- Phase 9: 15ファイル、5,872行追加
- Phase 10: 11ファイル、4,209行追加
- 累計: Phase 1-10で主要機能の半分以上を実装完了
