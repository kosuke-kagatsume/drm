# Claude Code 引き継ぎドキュメント

## 🎯 明日のClaude（またはあなた）へ

### 最重要情報

**最新URL**: https://web-frontend-flyxskjnw-kosukes-projects-c6ad92ba.vercel.app/

これが2025年10月12日の最新デプロイです。Phase 11完了版（PDF管理システム統合・ブランディング機能強化）。他のURLは古いので使わないこと。

### プロジェクト概要

- **場所**: `/Users/dw100/crm-monorepo/drm-suite/`
- **内容**: 建設業界向けCRM「DRMスイート」の見積システム
- **技術**: Next.js 14 + TypeScript + Tailwind CSS

### 最新の実装内容（2025/10/12）

#### 📄 Phase 11完了: PDF管理システム統合とブランディング機能強化 ✅

**コミット**: `3d5f7c5` - 2025/10/12
**デプロイURL**: https://web-frontend-flyxskjnw-kosukes-projects-c6ad92ba.vercel.app/

**Phase 11 実装内容**

**1. ランディングページ修正**

- ✅ containerクラスの衝突を解消（max-w-7xlに変更）
- ✅ グローバルCSSとの競合を回避
- ✅ レイアウトが正常に表示されるよう修正

**2. PDF管理システムの統合**

- ✅ 重複していた `/admin/branding` ページを削除
- ✅ `/admin/pdf-management` を唯一のPDF統合管理画面として維持
- ✅ ブランディング機能を「企業ブランディング」タブに統合

**3. 企業ブランディングタブの大幅強化**

4つのタブ構成に再設計:

- **基本企業情報タブ**
  - 会社名、郵便番号、住所（都道府県・市区町村・番地）
  - 電話番号、FAX、メールアドレス、Webサイト
  - 代表者名、代表者役職
  - 登録番号（適格請求書発行事業者）
  - 業種、設立年月日、資本金

- **ビジュアル設定タブ**
  - プライマリカラー、セカンダリカラー、アクセントカラー
  - フォント設定（見出し、本文）
  - ロゴ画像URL、スタンプ画像URL

- **銀行情報タブ** ⭐NEW
  - 銀行名
  - 支店名
  - 口座種別（普通/当座/その他）
  - 口座番号
  - 口座名義

- **プレビュータブ**
  - 設定内容のリアルタイムプレビュー

**統計**

- 8ファイル変更
- 1,973行追加、857行削除
- PDF管理機能の一元化完了

---

#### 🎨 経理ダッシュボードUI改善 ✅

**コミット**: `b3cec1c` - 2025/10/12

- **ヘッダーボタンの整理**
  - 9個のボタンを4個の主要機能に絞り込み
  - 工事台帳、勘定科目、新規請求書、エクスポート
  - 重複していた工事台帳ボタンを削除

- **レイアウトの改善**
  - 余白とスペーシングを拡大（gap-6→8, space-y-6→8）
  - ボタンスタイルを統一（rounded-lg、shadow-sm追加）
  - より洗練された視覚的階層を実現

- **リンクの修正**
  - 勘定科目ボタンを正しいパス（/admin/account-subjects）に修正
  - 工事台帳を/construction-ledgersに統一

---

### 過去の実装内容（2025/08/24）

#### 1. 見積作成フローの完全実装 ✅

- `/estimates/create-v2` - 2択の初期選択画面
  - 顧客情報がある → 顧客選択 → 見積タイプ選択
  - クイック見積 → 直接見積タイプ選択
- `/estimates/editor-v3` - 統一された詳細見積エディタ
  - マスタ原価の参照機能（階層選択UI）
  - コメント機能（サイドバー）
  - インポート/エクスポート機能

#### 2. 見積管理機能の大幅強化 🆕

- **ステータス管理**
  - 下書き → 提出済み → 交渉中 → 受注/失注
  - ステータス変更モーダル実装
- **失注分析機能**
  - 失注理由の記録（価格/仕様/納期/競合他社）
  - 競合情報の記録
- **複数見積管理（A案/B案/C案）**
  - 同一顧客への複数提案管理
  - 提案タイプのバッジ表示
- **受注率の可視化**
  - リアルタイム受注率計算
  - 統計ダッシュボード

### 実装済み機能一覧

1. **editor-v3** (`/estimates/editor-v3/[id]`)
   - 1500行以上の本格実装
   - ドラッグ&ドロップ対応
   - マスターデータ連携（75種類以上）
   - 原価管理・粗利計算
   - 階層型マスタ検索（商品種別→メーカー→製品）

2. **その他の見積画面**
   - `/estimates/financial/[id]` - 資金計画書
   - `/estimates/templates` - テンプレート管理
   - `/estimates/page.tsx` - 見積一覧（管理機能強化済み）

### 作業の始め方

```bash
# 1. ローカル開発サーバー起動
cd /Users/dw100/crm-monorepo/drm-suite/web-frontend
pnpm dev

# 2. 最新URLで動作確認
open https://web-frontend-qt2fly6eh-kosukes-projects-c6ad92ba.vercel.app/
```

### 次の開発タスク候補

- [ ] 見積から契約書への自動変換
- [ ] 契約後の請求書発行機能
- [ ] 工事進捗と請求の連動
- [ ] 承認ワークフローの実装
- [ ] 営業分析ダッシュボード（失注分析など）

### デプロイ方法

```bash
cd /Users/dw100/crm-monorepo/drm-suite/web-frontend
vercel --prod
# 新しいURLが出たら必ずこのファイルを更新すること！
```

### 重要な変更点

- 全ての見積編集はeditor-v3に統一済み
- create-v2が正式な見積作成フロー
- ステータス管理が業務フローに対応（受注/失注追跡可能）

---

最終更新: 2025/10/12 18:15
Phase 11完了: PDF管理システム統合・ブランディング機能強化・Vercelデプロイ完了
